(()=>{var e={13714:(e,t,a)=>{"use strict";let r,s,o;var l=a(24854);let i=["/Apps/Marked/marked.min.js","/Apps/Marked/purify.min.js"],n={balanced:{temperature:.5,topK:3},creative:{temperature:.8,topK:5},precise:{temperature:.2,topK:2}},p="Llama-3.1-8B-Instruct-q4f32_1-MLC",c={"Llama-3.1-8B-Instruct-q4f32_1-MLC":{frequency_penalty:0,max_tokens:4e3,presence_penalty:0,top_p:.9}},m={content:"You are a helpful AI assistant.",role:"system"},f=new AbortController,u=!1,d=!1,g=0,b=[],h=!1;globalThis.addEventListener("message",async({data:e})=>{if(e&&"init"!==e){if("cancel"===e)d&&(u=!0,console.log("CANCELLED!"));else if(e.id&&e.text&&e.style){if(d=!0,g!==e.id){if(g=e.id,e.hasWindowAI){b=[],s?.destroy(),r?.destroy();let t={...n[e.style],signal:f.signal,systemPrompt:m.content};r=await globalThis.ai.languageModel.create(t)}else if(b=[m],!o){let{CreateMLCEngine:e}=await Promise.all([a.e(6120),a.e(5606)]).then(a.bind(a,41692));u||(o=await e(p,{initProgressCallback:e=>globalThis.postMessage({progress:e})}))}}let t="",y=0,v=async a=>{r?.destroy(),b.push({content:e.text,role:"user"},{content:a||t,role:"assistant"});let s={...n[e.style],initialPrompts:[m,...b]};r=await globalThis.ai.languageModel.create(s)};try{if(e.hasWindowAI&&e.summarizeText&&"summarizer"in globalThis.ai&&(await globalThis.ai.summarizer.capabilities())?.available==="readily"&&(s=await globalThis.ai.summarizer.create()),e.imagePrompt&&e.offscreenCanvas){globalThis.tvmjsGlobalEnv=globalThis.tvmjsGlobalEnv||{},globalThis.tvmjsGlobalEnv.logger=(e,t)=>globalThis.postMessage({progress:{text:t}});try{globalThis.importScripts(...l.StableDiffusionLibs)}catch{}await (0,l.runStableDiffusion)({prompts:[[e.imagePrompt,""]]},e.offscreenCanvas,!0,!1),globalThis.tvmjsGlobalEnv.logger("",""),e.hasWindowAI&&v("I'll try to create that using Stable Diffusion 1.5.")}else{for(;y++<3&&!t&&!u;)try{if(e.hasWindowAI){let a=r,o={signal:f.signal};s&&e.summarizeText?(t=await s.summarize(e.summarizeText,o),v()):a&&(t=e.streamId?a.promptStreaming(e.text,o):await a.prompt(e.text,o)||"")}else{b.push({content:e.summarizeText?`Summarize:

${e.summarizeText}`:e.text,role:"user"});let a=!!e.streamId,r=await o.chat.completions.create({logprobs:!0,messages:b,stream:a,stream_options:{include_usage:!1},temperature:n[e.style].temperature,top_logprobs:n[e.style].topK,...c[p]});t=a?r:r.choices[0].message.content||""}}catch(e){console.error("Failed to get prompt response.",e)}t||console.error("Failed retires to create response.")}}catch(e){console.error("Failed to create text session.",e)}if(!u){if(t){h||(globalThis.importScripts(...i),h=!0);let a=(t,a)=>{globalThis.postMessage({formattedResponse:globalThis.marked.parse(t,{headerIds:!1,mangle:!1}),response:t,streamId:a}),b[b.length-1]?.role!=="user"&&b.push({content:e.text,role:"user"}),b.push({content:t,role:"assistant"})};if("string"==typeof t)a(t);else try{let r="";for await(let s of t){if(u)break;"string"==typeof s?a(s,e.streamId):(r+=s.choices[0]?.delta.content||"",a(r,e.streamId))}}catch(e){console.error("Failed to stream prompt response.",e)}}e.streamId&&globalThis.postMessage({complete:!0,streamId:e.streamId})}d=!1,u&&(u=!1,globalThis.postMessage("canceled"))}}},{passive:!0})}},t={};function a(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={exports:{}},l=!0;try{e[r](o,o.exports,a),l=!1}finally{l&&delete t[r]}return o.exports}a.m=e,a.x=()=>{var e=a.O(void 0,[8287,4854],()=>a(13714));return a.O(e)},(()=>{var e=[];a.O=(t,r,s,o)=>{if(r){o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,s,o];return}for(var i=1/0,l=0;l<e.length;l++){for(var[r,s,o]=e[l],n=!0,p=0;p<r.length;p++)(!1&o||i>=o)&&Object.keys(a.O).every(e=>a.O[e](r[p]))?r.splice(p--,1):(n=!1,o<i&&(i=o));if(n){e.splice(l--,1);var c=s();void 0!==c&&(t=c)}}return t}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;a.t=function(r,s){if(1&s&&(r=this(r)),8&s||"object"==typeof r&&r&&(4&s&&r.__esModule||16&s&&"function"==typeof r.then))return r;var o=Object.create(null);a.r(o);var l={};e=e||[null,t({}),t([]),t(t)];for(var i=2&s&&r;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach(e=>l[e]=()=>r[e]);return l.default=()=>r,a.d(o,l),o}})(),a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,r)=>(a.f[r](e,t),t),[])),a.u=e=>"static/chunks/"+(6120===e?"4cbe66a8":e)+"."+({1451:"865b02d172535ae0",4840:"7d183efb054fd745",4854:"6393a5e704bf36fb",5606:"c406d874a274b271",6120:"391905686e01e421",6529:"45d8ab30c0f6a2cd",8287:"3e9176f2d28086e4",8480:"b705387b6457e37c"})[e]+".js",a.miniCssF=e=>{},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.tt=()=>(void 0===e&&(e={createScriptURL:e=>e},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(e=trustedTypes.createPolicy("nextjs#bundler",e))),e)})(),a.tu=e=>a.tt().createScriptURL(e),a.p="/_next/",(()=>{var e={61:1};a.f.i=(t,r)=>{e[t]||importScripts(a.tu(a.p+a.u(t)))};var t=self.webpackChunk_N_E=self.webpackChunk_N_E||[],r=t.push.bind(t);t.push=t=>{var[s,o,l]=t;for(var i in o)a.o(o,i)&&(a.m[i]=o[i]);for(l&&l(a);s.length;)e[s.pop()]=1;r(t)}})(),(()=>{var e=a.x;a.x=()=>Promise.all([a.e(8287),a.e(4854)]).then(e)})(),_N_E=a.x()})();